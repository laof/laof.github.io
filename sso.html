<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h1> sso validate page</h1>
    <div id="showlog"></div>
    <div id="token"></div>
    <script>
        const search = window.location.search;
        const params = new URLSearchParams(search);
        const my_path = 'my_path';

        const timeout = () => new Promise(res => setTimeout(() => res('done'), 2000));

        function show(message) {
            document.getElementById('showlog').innerText = message;
        }

        if (params.get('path')) {
            show('1, set path: ' + params.get('path'))
            timeout().then(() => {
                sessionStorage.setItem(my_path, params.get('path'));
                const logout = 'https://daolang.netlify.app/ssologout'
                location.href = `${logout}?redirectURL=https://laof.github.io/sso?deeplink=openapp4`;
            });
        } else if (params.get('deeplink')) {
            show('2, deeplink: ' + sessionStorage.getItem(my_path));
            timeout().then(() => {
                // 3, from mcf redirect
                location.href = 'https://lttesting.manutouch.com.hk/openapp/uat4/get-token';
            });
        } else if (params.get('token')) {
            show('3, deeplink: ' + sessionStorage.getItem(my_path));
            timeout().then(() => {
                document.getElementById('token').innerText = '4, Token: ' + params.get('token');
            });
        }


    </script>

</body>

</html>
